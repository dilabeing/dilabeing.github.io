function notice(e,t,n){return $("<div/>",{"class":"notice "+t,html:e}).append(n===false?"":$("<span/>",{html:"&#10006;","class":"close","data-close":"true"}))}function time(){return Math.round((new Date).getTime()/1e3)}function search(){page.load("/search?q="+encodeURIComponent($("#q").val()))}function offset(e,t,n){if(e){e.preventDefault();e.stopPropagation()}var r=$(t);if(!r.length)return false;if(!window.isLoadingOffset){window.isLoadingOffset=true;$.getJSON(r.attr((r.is("a")?"":"data-")+"href"),function(e){r.replaceWith(e.content);if(n)n.call(window);delete window.isLoadingOffset})}return false}function od(e,t,n,r,i){e=e?1:0;t=parseInt(t);n=n&&user.steamid?user.steamid:0;r=parseInt(r)||0;i=$(i);if(!r)page.overlay.show({title:i.text(),content:'<span class="loading" style="display:block;width:50%;margin:40px auto;height:20px"></span>'});$.getJSON("/od",{type:e,defindex:t,compared:n,offset:r},function(e){var t=$("#overlay .content");if(!r){t.empty().append($("<div/>",{"class":"clear users",html:e.ok?e.result:notice(e.error||loc.e_common,"",false)}))}else{i.replaceWith(e.ok?e.result:notice(e.error||loc.e_common,"",false));var t=$("#overlay .content");t.scrollTop(t.find(".users").first().height())}})}function intersect(e,t){var n={},r=[];$.each(e,function(e,t){n[t]=true});$.each(t,function(e,t){if(n[t])r.push(t)});return r}function openSteamStore(e){window.open("http://www.dota2.com/store/itemdetails/"+e,"_blank")}function realtime_trades(){window.rt_trades=$.ajax({dataType:"json",global:false,url:"/realtime_trades?nc=1&"+Math.floor(Math.random()*1e6),start:function(){},success:function(e){var t=$("#realtime_trades");t.children().css("background-color","");$.each(e,function(e,n){if(t.children().length>9)t.children().last().remove();$(n).css({display:"none","background-color":"#d6e995"}).prependTo(t).slideDown(200)})},complete:function(e){if($("#realtime_trades").length&&e.status==200)realtime_trades()}})}function filter_heroes(e){if(/^\s$/.test(e))return;e=$.trim(e);var t=new RegExp(e,"i");$("#heropicker").find(".h-icon").fadeTo(0,1).each(function(){if(!t.test($(this).html()))$(this).fadeTo(300,.3)})}function hit(e){if(!e)return;$.get("/hit?act="+e)}window.isIE=/msie/i.test(navigator.userAgent)&&!/opera/i.test(navigator.userAgent);Array.prototype.tpush=function(e){var t=$.inArray(e,this);t>-1?this.splice(t,1):this.push(e)};Array.prototype.upush=function(e){if($.isArray(e)){for(var t=0;t<e.length;t++)this.upush(e[t])}else{if($.inArray(e,this)===-1)this.push(e)}};Array.prototype.pull=function(e){if($.isArray(e)){for(var t=0;t<e.length;t++)this.pull(e[t])}else{var t=$.inArray(e,this);while(t!==-1){this.splice(t,1);t=$.inArray(e,this)}}};jQuery.fn.countDown=function(e){var t=this,n=parseInt(this.html());if(!n)return;var r=setInterval(function(){if(n>1){t.html(--n)}else{clearInterval(r);if(e)e.call(t)}},1e3)};jQuery.fn.slideUpRemove=function(e){this.slideUp(e||200,function(){$(this).remove()})};jQuery.fn.notice=function(e,t,n){var r=this.html()?false:true;this.html("");if(!e)return;t=t||"";var i=$("<div/>",{html:e});if(!i.find(".notice").length)i.html(notice(e,t));i=i.html();if(n){this.html(i);return}r?this.hide().html(i).slideDown(300):this.fadeTo(200,.3).html(i).fadeTo(300,1)};jQuery.fn.share=function(e){var t=this,n={getUrl:function(t){t="_"+(t||"");if(!n[t]||!n[t].site)return;var t=n[t],r=[];$.each(e,function(e,n){if(t[e])r.push(t[e]+"="+n)});if(t.additional)r.push(t.additional);return t.site+"?"+r.join("&")},_fb:{site:"http://www.facebook.com/sharer.php",title:"p[title]",img:"p[images][0]",desc:"p[summary]",url:"p[url]",additional:"s=100"},_gl:{site:"https://plus.google.com/share",url:"url"},_rd:{site:"http://reddit.com/submit",url:"url",title:"title"},_tw:{site:"https://twitter.com/intent/tweet",url:"url",title:"text"},_vk:{site:"http://vk.com/share.php",title:"title",url:"url",img:"image",desc:"description",additional:"noparse=true"}};e=e||{};e.desc=encodeURIComponent(e.desc||$('meta[name="description"]').attr("content"));e.title=encodeURIComponent(e.title||document.title);e.url=encodeURIComponent(e.url||window.location.href.replace(/\?.*$/g,""));e.img=encodeURIComponent(e.img||"http://media.dota-trade.com/apple-touch-icon-114x114.png");t.addClass("share").empty();$.each({fb:"Facebook",gl:"Google+",rd:"Reddit",tw:"Twitter",vk:"ВКонтакте"},function(e,r){t.append($("<i/>",{title:r,"class":e,"data-uri":n.getUrl(e)}))});t.on("click","i",function(){window.open($(this).attr("data-uri"),"_blank","scrollbars=0, resizable=1, menubar=0, left=100, top=100, width=550, height=440, toolbar=0, status=0")})};$(function(){page.user(user||{});evt.load(events||"");if(isIE)$.ajaxSetup({data:{_ajax:1}});$(document).ajaxStart(function(){window.loaderSpanFN=setTimeout(function(){$("<span/>",{id:"loading-mark","class":"loading"}).appendTo(document.body)},1e3)}).ajaxStop(function(){clearTimeout(window.loaderSpanFN);$("#loading-mark").remove()}).ajaxError(function(e,t,n,r){page.notice('<span style="font-size:18px">#'+t.status+"</span><br>"+t.statusText,"red")});$("#content").on("keyup",".send-form textarea",function(){var e=$(this);e.closest(".send-form").attr("data-symb-left",e.val().length+"/"+e.attr("maxlength"))});$(document.body).on("click",'a[target!="_blank"]:not(".noajax,[href^=#]")',page.load).on("click","img.preview",function(){var e=$(this);$("<div/>",{id:"overlay",onclick:"page.overlay.hide()",html:'<div class="box"><img src="'+e.attr("src").replace(/img\/(faq|uploads|news|screenshots)\/[ml]\//,"img/$1/l/")+'"></div>'}).appendTo(document.body)}).on("click",'[data-close="true"]',function(){$(this).closest(".notice").slideUpRemove()}).on("click","a.addfriend,.share",function(){var e=this.className.replace(/.*(addfriend|share).*/g,"$1");setTimeout(function(){hit(e)},1e3)}).on("mouseenter",".inline_tile",function(){var e=$(this);window.tipLoad=setTimeout(function(){if(!e.find(".tip").length){var t=e.attr("href")||e.attr("data-href");if(/item$/i.test(t)){var n=$("<div/>",{css:{left:Math.round(-(207-e.width())/2)},"class":"tip",html:'<span class="loading" style="height:10px;width:80%;margin:37px auto"></span>'});e.append(n);$.get("/gettile?link="+t,function(e){if(e)n.html(e)})}}},500)}).on("mouseleave",".inline_tile",function(){clearTimeout(window.tipLoad)});dfp.init();(function(){var e=$("<div/>",{css:{visibility:"hidden",width:"100px",overflow:"scroll"}});$(document.body).append(e);var t=e[0].offsetWidth,n=$("<div/>",{css:{width:"100%"}});e.append(n);var r=n[0].offsetWidth;e.remove();window.scrollbarWidth=t-r-1})()});var users={update:function(e,t){$(t).fadeOut();setTimeout(function(){$(t).fadeIn()},3e3);$.getJSON("/profile?update",function(e){if(!e.ok){page.notice(e.error||loc.e_common,"red");$("#manSyncCounter").countDown(function(){$(this).closest(".notice").slideUpRemove()});return}page.user(e.result||{})})},data:function(e,t){$.getJSON("/userdata",$.extend({steamid:user.steamid||""},e),t)},authElems:function(){if(user.steamid&&user.karma>-100)$(".auth").removeClass("auth");else $(".auth").remove()},rate:function(e,t){t=t?1:-1;$.get("/rate",{u:e,v:t},function(n){if(n.ok){var r=$(".karma_"+e),i=parseInt(r.text())+(n.result||t);r.removeClass("pos neg");if(i<0)r.addClass("neg");else if(i>0){r.addClass("pos");i="+"+i}r.text(i)}else{page.notice(n.error||loc.e_common,"red")}})},highlight:function(){$.get("/profile?highlight",function(e){if(e.ok){page.karma(e.result.karma);var t=$(".highlighted_users"),n=t.find("div.user:first");if(n.length){n.replaceWith(e.result.tile)}else{t.find(".user:first").remove().end().append(e.result.tile)}$("#pin_me_btn").remove()}else{page.notice(e.error,"red")}})},openProfile:function(e){window.open("http://steamcommunity.com/profiles/"+e,"_blank")}},page={ce:{},user:function(e){window.user=$.extend(window.user||{},e);if(typeof user.unread_messages!=="undefined")page.messages(user.unread_messages);if(user.nick)page.nick(user.nick);if(user.avatar)page.avatar(user.avatar);if(typeof user.karma!=="undefined")page.karma(user.karma);return page},set:function(e,t,n){if(!page.ce[e])page.ce[e]=$("#"+e);page.ce[e].html(t||n||"")},metadesc:function(e){$('meta[name="description"]').attr("content",e||"");return page},messages:function(e){page.set("messages",e>0?e:0,"");page.ce.messages.parent()[(e>0?"remove":"add")+"Class"]("spr");return page},nick:function(e){page.set("nick",e,"Unknown");return page},avatar:function(e){if(!e)return false;if(!page.ce.avatar)page.ce.avatar=$("#avatar");page.ce.avatar.css("background-image",'url("http://media.steampowered.com/steamcommunity/public/images/avatars/'+e+'_medium.jpg")');return page},karma:function(e){e=parseInt(e)||0;if(e>0)e="+"+e;if(!page.ce.avatar)page.ce.avatar=$("#avatar");var t=page.ce.avatar.find("b.karma").first();t.removeClass("pos neg").html(e);if(e>0)t.addClass("pos");else if(e<0)t.addClass("neg")},h1:function(e){page.set("title",e);return page},title:function(e){document.title=e.replace("&#039;","'")||"";return page},notice:function(e,t,n){if(!page.ce.notice)page.ce.notice=$("#notice");page.ce.notice.notice(e||"",t||"",n||false);return page},content:function(e){page.set("content",e);return page},time:function(e){page.set("time",e,"-");return page},memory:function(e){page.set("memory",e,"-");return page},fill:function(e){e=e||{};page.user(e.user||{});if(e.debug){if(e.debug.time)page.time(e.debug.time);if(e.debug.memory)page.memory(e.debug.memory)}page.title(e.metatitle||"").h1(e.title||"").notice(e.notice||"","",true).content(e.content||"").metadesc(e.metadescription||"");evt.load(e.events||"")},load:function(e,t){var n;if(typeof e=="object"){n=$(this).attr("href");e.preventDefault();e.stopPropagation()}else n=e;$.getJSON(n,function(e){page.fill(e);page.location(e.metatitle||e.title,n);dfp.display();_gaq.push(["_trackPageview",n])});return false},oload:function(e,t){$.getJSON(e,function(e){page.overlay.show({content:e.content,title:e.title,footer:t||""});evt.load(e.events||"",true)})},confirm:function(e){$("#save-discard")[(e?"remove":"add")+"Class"]("hide")},overlay:{show:function(e){if(page.overlay.h)page.overlay.hide();if(isIE)$("#video").hide();e=$.extend({title:"Dota Trade",content:"",footer:""},e);var t=$("<div/>",{id:"overlay"}).append($("<div/>",{"class":"box"}).append($("<div/>",{"class":"header clear",html:e.title+'<i data-action="close" class="fr icon-remove icon-white"></i>'})).append($("<div/>",{"class":"content",html:e.content})).append($("<div/>",{"class":"footer",html:e.footer}).append(' <button data-action="close"><i class="icon-remove icon-white"></i> '+(loc.close||"Close")+"</button>")));t.on("click",'a[target!="_blank"],[data-action="close"]',function(){page.overlay.hide()});$(document.body).css({overflow:"hidden","margin-left":Math.floor(-window.scrollbarWidth/2)}).append(t)},hide:function(){$("#overlay").remove();$(document.body).css({overflow:"","margin-left":0});if(isIE)$("#video").show()}}},evt={curEvt:null,load:function(e,t){e="_"+(e||"");if(!evt[e])return;if(!t&&evt.curEvt!==null)evt[evt.curEvt](false);evt[e].call(this,true);evt.curEvt=e},off:function(e){for(i=0;i<e.length;i++)$(e[i][0]).off(e[i][1])},_items:function(e){var t=[[window,"scroll.autoLoadOffset"]];if(!e){evt.off(t);return}$(t[0][0]).on(t[0][1],function(){if(document.documentElement.clientHeight+$(window).scrollTop()+350>document.body.scrollHeight){offset(null,"#offset-loader",function(){items.wb.add();items.fadeIHave()})}});items.wb.add();items.fadeIHave()},_sets:function(e){var t=[[window,"scroll.autoLoadOffset"]];if(!e){evt.off(t);return}$(t[0][0]).on(t[0][1],function(){if(document.documentElement.clientHeight+$(window).scrollTop()+350>document.body.scrollHeight){offset(null,"#offset-loader")}})},_myinventory:function(e){var t=[["#myinventory","click.checkSingle",".tile"]];if(!e){evt.off(t);return}myinventory.changes=[];$(t[0][0]).on(t[0][1],t[0][2],function(e){if($(e.target||e.srcElement).is(".tile,img"))myinventory.markSingle(this)});myinventory.init();if(user.steamid){window.user.inventory=items.ulist(".tile")||[];if(localStorage&&JSON){localStorage.setItem("inventory",JSON.stringify(user.inventory))}}},_mywishlist:function(e){if(!user.steamid)return;var t=[["#mywishlist","click.unwishItem",".tile"],["#wishany","click.wishAnyClck",".wishany"]];if(!e){evt.off(t);return}mywishlist.remove=[];mywishlist.init();$(t[0][0]).on(t[0][1],t[0][2],function(e){if($(e.target||e.srcElement).is(".tile,img"))mywishlist.markToRemove(this)});$(t[1][0]).on(t[1][1],t[1][2],function(){var e=$(this),t=parseInt(e.attr("data-id"))||0,n=e.attr("data-class")||"",r=e.attr("data-img")||"";if(t&&r&&mywishlist.wishItem(t)){var i=$("#mywishlist .tile"),s='<div class="tile '+n+'" data-id="'+t+'"><span class="img"><img style="border:0" width="85" height="57" src="http://media.dota-trade.com/img/items/any/m/'+r+'.jpg" alt=""></span></div>';if(i.length&&i.length<32&&!(i.length%8)){for(var o=0;o<8;o++){$("#mywishlist .tiles").append('<div class="tile-dummy"></div>')}}if(i.length<32){$("#mywishlist").find(".tile-dummy").first().replaceWith(s)}else{$("#mywishlist .tiles").find(".tile").first().remove().end().end().append(s)}}});$("#mywishlist").after(lastviewed.get("lv_items"))},_item:function(e){if(!e){return}users.authElems();if(user.steamid){lastviewed.add("lv_items",$("#title").text(),window.location.pathname);items.fadeIHave()}$(".share").share({img:$("#item .icon img").first().attr("src")});mywishlist.init(function(e){if($.inArray(items.getid("#item"),e)===-1)$("#wishButton").removeClass("hide");items.wb.append();items.wb.checkByDefindex(e)})},_hero:function(e){if(!e){return}users.authElems();items.wb.add();items.fadeIHave();$(".share").share({img:$("#hero img").first().attr("src")})},_thread:function(e){if(!e){if(window.read_inbox)window.read_inbox.abort();return}if(user.steamid&&user.karma<config.bad_karma2)$("#add_steam_friend").remove();if($('#title .is_online:not(".not")').length){pm.read_inbox(true)}var t=parseInt($("#messages").html())||0;if(!t)return;page.messages(t-parseInt($("#thread").attr("data-unread")))},_threads:function(e){if(!e){if(window.read_inbox)window.read_inbox.abort();return}if(user.steamid)$("#content").append(lastviewed.get("lv_users"))},_user:function(e){if(!e){return}users.authElems();if(user.steamid){var t=new RegExp(user.steamid+"$"),n=t.test($("#user").attr("data-id"));if(user.inventory_ucount&&user.inventory_ucount<10||n||user.karma&&user.karma<config.bad_karma){$(".karma_bar button").remove()}if(n||user.karma&&user.karma<config.bad_karma2){$("#send_message_btn, #add_steam_friend").remove()}lastviewed.add("lv_users",$("#title").clone().find("span").remove().end().text().trim(),window.location.pathname);items.wb.add();items.fadeIHave();myinventory.init();setTimeout(function(){var e=intersect(items.ulist("#wishlist .tile"),user.tradelist||[]),t=intersect(items.ulist("#inventory .tile.tr"),user.wishlist||[]),n=0,r=$("<div/>",{"class":"tiles clear"}),i=$("<div/>",{css:{display:"none"}});if(e.length||t.length){i.append('<h2><i class="icon-check"></i> '+loc.available_trades+"</h2>");if(e.length){n=6-e.length%6;n=n!==6?n:0;while(e.length)$('.tile[data-id="'+e.pop()+'"]').first().clone().appendTo(r);while(n--)r.append('<div class="tile-dummy"></div>');i.append('<span class="red-label">'+loc.he_want+"</span>").append(r.clone());r.empty()}if(t.length){n=6-t.length%6;n=n!==6?n:0;while(t.length)$('.tile[data-id="'+t.pop()+'"]').first().clone().removeClass("tr eq").appendTo(r);while(n--)r.append('<div class="tile-dummy"></div>');i.append('<span class="red-label">'+loc.he_has+"</span>").append(r.clone())}$("#compares").html(i);i.fadeIn()}},1e3)}},_users:function(e){if(!e){return}var t=new RegExp("/"+user.steamid+'"',"g");if(user.steamid&&(user.karma<=config.good_karma||t.test($(".highlighted_users").html())))$("#pin_me_btn").remove();users.authElems()},_set:function(e){if(!e){return}users.authElems();items.wb.add();items.fadeIHave();$(".share").share({img:$("#set img").first().attr("src")})},_mainitems:function(e){if(!e){return}items.wb.add();items.fadeIHave()},_profile:function(e){if(!e){return}$(".share").share({title:$("#nick").text(),url:$("#p_link").text(),img:$("#avatar").css("background-image").replace(/url\((.*)_medium.*/g,"$1_full.jpg")})},_trades:function(e){clearInterval(window.tradesTimer);if(!e){return}if(!user.steamid)return;var t=localStorage&&localStorage.getItem("trades")||null;if(t==null||t=="undefined"){$("#trades").empty();mywishlist.init(function(e){if(!e.length){page.content(notice(loc.i_empty_wl,"",false));return}$.each(e,function(e,t){var n=e+1;if(t<0)return;$("#trades").append($("<div/>",{"class":"black-label",html:loc.wishlist_item+" #"+n})).append($("<div/>",{css:{"margin-bottom":"25px","min-height":"113px"},"class":"clear users layout",id:"compares_"+n,html:'<span class="loading" style="width:70%;height:20px;margin-top:40px"></span>'}))});var t=0;window.tradesTimer=setInterval(function(){if(t>=e.length){clearInterval(window.tradesTimer);if(localStorage)localStorage.setItem("trades",$("#trades").html());return}$.getJSON("/od?type=1&compared="+user.steamid+"&offset=0&defindex="+e[t++],function(e){$("#compares_"+t).hide().css("min-height","").html(e.ok?e.result:notice(e.error||loc.e_common,"",false)).fadeIn()})},user.karma>=config.good_karma?1e3:3e3)})}else{$("#trades").html(t)}},_index:function(e){if(!e){if(window.rt_trades)window.rt_trades.abort();return}realtime_trades()}},pm={readAll:function(){$.get("/messages?readall",function(e){if(e.ok){$(".inbox_cnt").remove();page.messages(0)}else{page.notice(e.error||loc.e_common,"red")}})},play_sound:function(){var e='<audio autoplay><source src="http://media.dota-trade.com/inbox.wav" type="audio/wav"></audio>';$(document.body).append(e);setTimeout(function(){$("audio").remove()},5e3)},read_inbox:function(e){if(!user.steamid)return;var t={nc:1,steamid:user.steamid};if(e)t.fast=1;window.read_inbox=$.ajax({dataType:"json",global:false,url:"/check_inbox",data:t,start:function(){},success:function(e){if(e.ok&&e.unread>0){if(e.playsound)pm.play_sound();var t=false;if(/^\/messages\/[0-9]{17}$/.test(window.location.pathname)){t="thread"}else if(window.location.pathname=="/messages"){t="threads"}if(t)$.getJSON(window.location.pathname,{no_tb:2,ts:Math.floor(Math.random()*1e5)},function(e){$("#"+t).replaceWith(e.content)});if(t!="thread")page.messages(e.unread)}},complete:function(t){if(($("#threads").length||$("#thread").length)&&t.status===200)pm.read_inbox(e||false)}})}},items={getid:function(e){return parseInt($(e).attr("data-id"))||0},list:function(e,t){var n=$(e),r=[];n.each(function(){r[t||"push"](items.getid(this))});return r},ulist:function(e){return items.list(e,"upush")},fadeTrash:function(e){var t=$(e),n=(1+parseInt(t.attr("data-state"))||0)%2;t.attr("data-state",n).find(".tile.b_rar_1 .img").fadeTo(0,n||.25)},fadeIHave:function(e){if(!user.steamid)return;var t=myinventory.get();$(e||".item-rows tr, .tile").each(function(){if($.inArray(items.getid(this),t)>-1)$(this).addClass("faded")})},wb:{_c:"icon-ok",append:function(e){if(!user.steamid)return;var t=$("<i/>",{"class":"wb icon-plus-sign",onclick:"items.wb.click(event,this)"});$(e||".item-rows, .tiles").not(".appended").find(".name").prepend(t).end().addClass("appended")},click:function(e,t){var n=$(t),r=items.getid(n.closest(".tile,tr"));n.toggleClass("icon-ok");mywishlist[(n.hasClass("icon-ok")?"":"un")+"wishItem"](r)},checkByDefindex:function(e,t){var n=[];e=$.isArray(e)?e:[e];$.each(e,function(e,t){n.push('[data-id="'+t+'"]')});if(!n.length)return;$(n.join(",")).find(".wb"+(t?".icon-ok":':not(".icon-ok")'))[(t?"remove":"add")+"Class"]("icon-ok")},add:function(){if(!user.steamid)return;items.wb.append();mywishlist.init(function(e){items.wb.checkByDefindex(e)})}}},myinventory={toggleState:0,changes:[],markSingle:function(e){myinventory.changes.tpush(parseInt($(e).toggleClass("tr").attr("data-pos")));page.confirm(myinventory.changes.length)},markAll:function(e){$("#myinventory .tile"+(e?':not(".tr")':".tr")).each(function(){myinventory.markSingle(this)})},toggleAll:function(){myinventory.markAll(++myinventory.toggleState%2)},markUnequipped:function(){myinventory.markAll(false);$('#myinventory .tile:not(".tr,.eq")').each(function(){myinventory.markSingle(this)})},markDuplicates:function(){myinventory.markAll(false);var e={};$("#myinventory .tile").each(function(){var t=$(this),n=parseInt(t.attr("data-id"));if(!e[n])e[n]={tiles:[],sub:1};t.hasClass("eq")?e[n].sub=0:e[n].tiles.push(this)});$.each(e,function(e,t){var n=t.tiles.length,r=n?n-t.sub:n;while(r)myinventory.markSingle(t.tiles[--r])})},tradeshot:function(){if(!user.steamid)return;var e=$("<iframe/>",{src:"/tradeshot",css:{display:"none"}});if(user.karma>config.good_karma){var t="http://dota-trade.com/"+user.steamid+".jpg";page.notice(loc.static_tradeshot_link+': <a target="_blank" href="'+t+'">'+t+"</a>","green")}$(document.body).append(e);setTimeout(function(){e.remove()},1e4)},save:function(){if(!myinventory.changes.length){page.confirm(false);return}$.post("/inventory",{save:myinventory.changes.join(",")},function(e){if(e.ok){myinventory.changes=[];page.confirm(false);myinventory.init()}else{page.notice(e.error||loc.e_common,"red")}},"json")},discard:function(){$("#myinventory .tile").each(function(){if($.inArray(parseInt($(this).attr("data-pos")),myinventory.changes)>-1)myinventory.markSingle(this)})},update:function(e,t){$(t).fadeOut();setTimeout(function(){$(t).fadeIn()},3e3);$.getJSON("/inventory?update",function(e){if(e.error){page.notice(e.error,"red");$("#manSyncCounter").countDown(function(){$(this).closest(".notice").slideUpRemove()});return}page.content(e.content);page.notice(e.notice||"");evt.load(e.events)})},get:function(){if(!user.inventory&&localStorage){user.inventory=$.parseJSON(localStorage.getItem("inventory"))||[]}return user.steamid&&user.inventory||[]},init:function(e){if(!user.steamid)return;var t=$("#myinventory");if(t.length){user.tradelist=items.ulist(t.find(".tile.tr"));if(localStorage&&JSON)localStorage.setItem("tradelist",JSON.stringify(user.tradelist))}else{if(typeof user.tradelist==="undefined"){var n=localStorage&&localStorage.getItem("tradelist")||null;if(n===null){users.data({get:"tradelist"},function(t){if(t.ok&&t.result.tradelist){user.tradelist=t.result.tradelist;if(localStorage&&JSON)localStorage.setItem("tradelist",JSON.stringify(user.tradelist));if(e)e.call(this,user.tradelist)}});return}else{user.tradelist=$.parseJSON(n)}}}if(e)e.call(user.tradelist)}},mywishlist={remove:[],removeall:false,wishItem:function(e){if(!$.isArray(e))e=[e];e.pull(user.wishlist||[]);if(!e.length)return false;$.getJSON("/wishlist",{add:e.join(",")},function(t){if(t.ok){user.wishlist=user.wishlist||[];user.wishlist.upush(e);if(localStorage&&JSON)localStorage.setItem("wishlist",JSON.stringify(user.wishlist));items.wb.checkByDefindex(e)}else{page.notice(t.error||loc.e_common,"red");items.wb.checkByDefindex(e,true)}});return true},unwishItem:function(e){mywishlist.remove.upush(e);mywishlist["delete"]()},isWished:function(e){return $.inArray(e,user.wishlist)>-1?true:false},"delete":function(){$.getJSON("/wishlist",mywishlist.removeall?{removeall:1}:{remove:mywishlist.remove.join(",")},function(e){if(e.ok){var t=$("<div/>",{"class":"tile-dummy"});if(mywishlist.removeall)user.wishlist=[];user.wishlist=user.wishlist||[];user.wishlist.pull(mywishlist.remove);if(localStorage&&JSON)localStorage.setItem("wishlist",JSON.stringify(user.wishlist));mywishlist.remove=[];page.confirm(false);$("#mywishlist .tile.rem").replaceWith(t)}else{page.notice(e.error||loc.e_common,"red")}mywishlist.removeall=false})},markToRemove:function(e){mywishlist.removeall=false;var t=items.getid(e);mywishlist.remove.tpush(t);$("#mywishlist .tile[data-id="+t+"]").toggleClass("rem");page.confirm(mywishlist.remove.length)},discard:function(){mywishlist.remove=[];$("#mywishlist .tile.rem").removeClass("rem");page.confirm(false)},init:function(e){if(!user.steamid)return;var t=$("#mywishlist");if(t.length){user.wishlist=items.ulist(t.find(".tile"));if(localStorage&&JSON)localStorage.setItem("wishlist",JSON.stringify(user.wishlist))}else{if(typeof user.wishlist==="undefined"){var n=localStorage&&localStorage.getItem("wishlist")||null;if(n===null){users.data({get:"wishlist"},function(t){if(t.ok&&t.result.wishlist){user.wishlist=t.result.wishlist;if(localStorage&&JSON)localStorage.setItem("wishlist",JSON.stringify(user.wishlist));if(e)e.call(this,user.wishlist)}});return}else{user.wishlist=$.parseJSON(n)}}}if(e)e.call(this,user.wishlist)},markAllToRemove:function(){$("#mywishlist .tile").addClass("rem");mywishlist.removeall=true;if(user.wishlist.length)page.confirm(true)}},send={getElems:function(e){var t=$(e).closest(".send-form");return{form:t,message:t.find(".message-body"),error:t.find(".send-error")}},validateText:function(e){return/^\s*$/.test(e)?false:true},comment:function(e){var t=send.getElems(e),n=t.message.val(),r=$("#comments"),i=new RegExp("/"+user.steamid+"$");if(!send.validateText(n)){t.error.notice(loc.e_short_message,"red");return}$.post("/addcomment",{object:t.form.attr("data-object"),id:t.form.attr("data-recid"),text:n},function(e){if(e.ok){r.find(".notice").remove().end().prepend(e.result);t.message.val("")}else{t.error.notice(e.error||loc.e_common,"red")}})},pm:function(e){var t=send.getElems(e),n=$("#thread");if(!send.validateText(t.message.val())){t.error.notice(loc.e_short_message,"red");return}$.post("/pm",{to:t.form.attr("data-recipient"),text:t.message.val()},function(e){if(e.ok){n.find(".notice").remove().end().prepend(e.result);t.message.val("")}else{t.error.notice(e.error||loc.e_common,"red")}},"json")},note:function(e){var t=send.getElems(e);$.post("/profile",{note:t.message.val()},function(e){if(e.ok){t.message.val(e.result)}else{t.error.notice(e.error,"red")}},"json")}},lastviewed={add:function(e,t,n){setTimeout(function(){if(localStorage){var r=$.parseJSON(localStorage.getItem(e))||[],i=false;$.each(r,function(e,t){if(t.uri===window.location.pathname)i=true});if(!i){r.push({title:t,uri:n});localStorage.setItem(e,JSON&&JSON.stringify(r.splice(-15,15))||"[]")}}},500)},get:function(e){var t=localStorage&&$.parseJSON(localStorage.getItem(e))||[],n=$("<ul/>",{"class":"last_viewed"});if(t.length){$.each(t,function(e,t){n.append('<li><a href="'+t.uri+'">'+t.title+"</a></li>")});var r=$("<div/>");r.append("<h2>"+loc.last_viewed+"</h2>").append(n);return r.html()}return""}},upload_form={_show:function(e,t){$.getJSON("/upload_"+e+"?id="+t,function(e){if(e.ok){page.overlay.show({title:e.result.title,content:e.result.content,footer:e.result.footer})}else{page.notice(loc.e_common,"red")}})},screenshot:function(e){upload_form._show("screenshot",e||0)},video:function(e){upload_form._show("video",e||0)},callback:function(){var e=window.frames.upload_frame.document.body.innerText||"{ok:1}",t=$("#upload_form_notices");e=$.parseJSON(e)||{};if(e.ok){t.notice(e.result,"green");var n=$("#screenshot_input");n.after('<input type="file" name="screenshot" id="screenshot_input">').remove();$("#video_input").val("")}else{t.notice(e.error||loc.e_common,"red")}},submit:function(){$("#upload_form").submit()}},dfp={pubID:12332148,lastRefreshTS:time(),rendered:0,slots:{},init:function(){googletag.cmd.push(function(){googletag.pubads().collapseEmptyDivs();googletag.enableServices();dfp.display()})},display:function(){dfp.rendered=0;if(user.karma&&user.karma>=config.good_karma)dfp.rendered=3;if(/^\/users/.test(window.location.pathname||"")){dfp.rendered=4}var e={},t=[],n=time();for(var r=1;r<4;r++){$(".adslot"+r).each(function(){var n=$(this);if(++dfp.rendered>3){n.hide().attr("id","ad-slot-"+Math.floor(Math.random()*999999)).empty();dfp.rendered--;return}var r=parseInt(n.attr("data-w")),i=parseInt(n.attr("data-h")),s=n.attr("id"),o=n.attr("data-unit")||null;if(!r||!i||!s)return;googletag.cmd.push(function(){if(!dfp.slots[s]){e[s]=googletag.defineSlot("/"+dfp.pubID+"/"+(o==null?"Common_"+r+"_"+i:o),[r,i],s).addService(googletag.pubads());googletag.display(s)}else{e[s]=dfp.slots[s];t.push(dfp.slots[s])}});n.css("display","block")})}if(t.length&&n-dfp.lastRefreshTS>4){dfp.lastRefreshTS=n;googletag.cmd.push(function(){googletag.pubads().refresh(t)})}dfp.slots=e}};(function(e){if(e){var t=window.location.hash;if(t.charAt(1)=="/")window.location.href="/"+t.replace(/#\//g,"");history.replaceState({uri:window.location.href},document.title);page.location=function(e,t){history.pushState({uri:t},e,t)};$(window).on("popstate",function(e){var t=e.state||e.originalEvent.state||{};if(t.uri)$.getJSON(t.uri,page.fill)})}else{page.location=function(e,t){window.location.hash=t};$(window).on("hashchange",function(){var e=window.location.hash;if(e.charAt(1)==="/"){if(window.location.pathname!=="/"){window.location.href="/"+e;return}$.getJSON(e.replace(/#/g,""),page.fill)}});setTimeout(function(){$(window).trigger("hashchange")},50)}})(history.pushState||false);var googletag=googletag||{};googletag.cmd=googletag.cmd||[];(function(){var e=document.createElement("script");e.async=true;e.type="text/javascript";var t="https:"==document.location.protocol;e.src=(t?"https:":"http:")+"//www.googletagservices.com/tag/js/gpt.js";var n=document.getElementsByTagName("script")[0];n.parentNode.insertBefore(e,n)})();var _gaq=_gaq||[];_gaq.push(["_setAccount","UA-34136711-1"],["_setDomainName",".dota-trade.com"],["_trackPageview"]);(function(){var e=document.createElement("script");e.type="text/javascript";e.async=true;e.src=("https:"==document.location.protocol?"https://ssl":"http://www")+".google-analytics.com/ga.js";var t=document.getElementsByTagName("script")[0];t.parentNode.insertBefore(e,t)})()